import{h as b,d as le,ax as Ae,ay as Se,az as ye,b as ue,g as ce,e as z,i as R,U as be,A as S,_ as me,H as ke,j as ee,k as J,l as q,al as we,m as oe,aA as B,ap as ve,M as L,aB as ae,R as Ie,I as re,P as Ce,aC as G,aD as Oe,ao as De,aE as ge,aF as Re,aG as V,aH as xe,aj as Ue,aa as Fe,a9 as He,q as _e,aI as de,aJ as Le,E as Me,aK as Qe,aL as Pe,n as Je,u as qe,aM as Be,a7 as Ke,Q as F,ae as se,af as te,ag as We,aN as ze,aO as Ge,K as ne,at as he,x as Ve,C as Ye}from"./CPsl3SyV.js";import{a as Ze,w as Xe}from"./CyvPbeUe.js";import{a as M}from"./D0lrbJ_H.js";import{b as $e,d as je}from"./BwVOdHzT.js";function va(a,e,r){b&&le();var f=a,s=be,u,l=Ae()?Se:ye;ue(()=>{l(s,s=e())&&(u&&ce(u),u=z(()=>r(f)))}),b&&(f=R)}function _a(a,e){return e}function ea(a,e,r,f){for(var s=[],u=e.length,l=0;l<u;l++)Oe(e[l].e,s,!0);var v=u>0&&s.length===0&&r!==null;if(v){var T=r.parentNode;De(T),T.append(r),f.clear(),O(a,e[0].prev,e[u-1].next)}ge(s,()=>{for(var h=0;h<u;h++){var c=e[h];v||(f.delete(c.k),O(a,c.prev,c.next)),Re(c.e,!v)}})}function da(a,e,r,f,s,u=null){var l=a,v={flags:e,items:new Map,first:null},T=(e&de)!==0;if(T){var h=a;l=b?J(Fe(h)):h.appendChild(He())}b&&le();var c=null,y=!1,n=me(()=>{var t=r();return Ce(t)?t:t==null?[]:ve(t)});ue(()=>{var t=S(n),i=t.length;if(y&&i===0)return;y=i===0;let E=!1;if(b){var p=l.data===ke;p!==(i===0)&&(l=ee(),J(l),q(!1),E=!0)}if(b){for(var A=null,N,_=0;_<i;_++){if(R.nodeType===8&&R.data===we){l=R,E=!0,q(!1);break}var o=t[_],d=f(o,_);N=Ee(R,v,A,null,o,d,_,s,e,r),v.items.set(d,N),A=N}i>0&&J(ee())}b||aa(t,v,l,s,e,f,r),u!==null&&(i===0?c?oe(c):c=z(()=>u(l)):c!==null&&ce(c,()=>{c=null})),E&&q(!0),S(n)}),b&&(l=R)}function aa(a,e,r,f,s,u,l){var Y,Z,X,$;var v=(s&Le)!==0,T=(s&(V|G))!==0,h=a.length,c=e.items,y=e.first,n=y,t,i=null,E,p=[],A=[],N,_,o,d;if(v)for(d=0;d<h;d+=1)N=a[d],_=u(N,d),o=c.get(_),o!==void 0&&((Y=o.a)==null||Y.measure(),(E??(E=new Set)).add(o));for(d=0;d<h;d+=1){if(N=a[d],_=u(N,d),o=c.get(_),o===void 0){var x=n?n.e.nodes_start:r;i=Ee(x,e,i,i===null?e.first:i.next,N,_,d,f,s,l),c.set(_,i),p=[],A=[],n=i.next;continue}if(T&&ra(o,N,d,s),o.e.f&B&&(oe(o.e),v&&((Z=o.a)==null||Z.unfix(),(E??(E=new Set)).delete(o))),o!==n){if(t!==void 0&&t.has(o)){if(p.length<A.length){var D=A[0],m;i=D.prev;var g=p[0],Q=p[p.length-1];for(m=0;m<p.length;m+=1)ie(p[m],D,r);for(m=0;m<A.length;m+=1)t.delete(A[m]);O(e,g.prev,Q.next),O(e,i,g),O(e,Q,D),n=D,i=Q,d-=1,p=[],A=[]}else t.delete(o),ie(o,n,r),O(e,o.prev,o.next),O(e,o,i===null?e.first:i.next),O(e,i,o),i=o;continue}for(p=[],A=[];n!==null&&n.k!==_;)n.e.f&B||(t??(t=new Set)).add(n),A.push(n),n=n.next;if(n===null)continue;o=n}p.push(o),i=o,n=o.next}if(n!==null||t!==void 0){for(var U=t===void 0?[]:ve(t);n!==null;)n.e.f&B||U.push(n),n=n.next;var P=U.length;if(P>0){var Te=s&de&&h===0?r:null;if(v){for(d=0;d<P;d+=1)(X=U[d].a)==null||X.measure();for(d=0;d<P;d+=1)($=U[d].a)==null||$.fix()}ea(e,U,Te,c)}}v&&_e(()=>{var j;if(E!==void 0)for(o of E)(j=o.a)==null||j.apply()}),L.first=e.first&&e.first.e,L.last=i&&i.e}function ra(a,e,r,f){f&V&&ae(a.v,e),f&G?ae(a.i,r):a.i=r}function Ee(a,e,r,f,s,u,l,v,T,h){var c=(T&V)!==0,y=(T&xe)===0,n=c?y?Ie(s):re(s):s,t=T&G?re(l):l,i={i:t,v:n,k:u,a:null,e:null,prev:r,next:f};try{return i.e=z(()=>v(a,n,t,h),b),i.e.prev=r&&r.e,i.e.next=f&&f.e,r===null?e.first=i:(r.next=i,r.e.next=i.e),f!==null&&(f.prev=i,f.e.prev=i.e),i}finally{}}function ie(a,e,r){for(var f=a.next?a.next.e.nodes_start:r,s=e?e.e.nodes_start:r,u=a.e.nodes_start;u!==f;){var l=Ue(u);s.before(u),u=l}}function O(a,e,r){e===null?a.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}function ha(a,e,r){var f=a.__className,s=pe(e);b&&a.getAttribute("class")===s?a.__className=s:(f!==s||b&&a.getAttribute("class")!==s)&&(s===""?a.removeAttribute("class"):a.setAttribute("class",s),a.__className=s)}function Ea(a,e,r){var f=a.__className,s=pe(e);b&&a.className===s?a.__className=s:(f!==s||b&&a.className!==s)&&(e==null?a.removeAttribute("class"):a.className=s,a.__className=s)}function pe(a,e){return(a??"")+""}const sa=()=>performance.now(),I={tick:a=>requestAnimationFrame(a),now:()=>sa(),tasks:new Set};function Ne(){const a=I.now();I.tasks.forEach(e=>{e.c(a)||(I.tasks.delete(e),e.f())}),I.tasks.size!==0&&I.tick(Ne)}function ta(a){let e;return I.tasks.size===0&&I.tick(Ne),{promise:new Promise(r=>{I.tasks.add(e={c:a,f:r})}),abort(){I.tasks.delete(e)}}}function H(a,e){Xe(()=>{a.dispatchEvent(new CustomEvent(e))})}function na(a){if(a==="float")return"cssFloat";if(a==="offset")return"cssOffset";if(a.startsWith("--"))return a;const e=a.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function fe(a){const e={},r=a.split(";");for(const f of r){const[s,u]=f.split(":");if(!s||u===void 0)break;const l=na(s.trim());e[l]=u.trim()}return e}const ia=a=>a;function pa(a,e,r,f){var s=(a&ze)!==0,u=(a&Ge)!==0,l=s&&u,v=(a&Be)!==0,T=l?"both":s?"in":"out",h,c=e.inert,y=e.style.overflow,n,t;function i(){var _=We,o=L;se(null),te(null);try{return h??(h=r()(e,(f==null?void 0:f())??{},{direction:T}))}finally{se(_),te(o)}}var E={is_global:v,in(){var _;if(e.inert=c,!s){t==null||t.abort(),(_=t==null?void 0:t.reset)==null||_.call(t);return}u||n==null||n.abort(),H(e,"introstart"),n=W(e,i(),t,1,()=>{H(e,"introend"),n==null||n.abort(),n=h=void 0,e.style.overflow=y})},out(_){if(!u){_==null||_(),h=void 0;return}e.inert=!0,H(e,"outrostart"),t=W(e,i(),n,0,()=>{H(e,"outroend"),_==null||_()})},stop:()=>{n==null||n.abort(),t==null||t.abort()}},p=L;if((p.transitions??(p.transitions=[])).push(E),s&&Ze){var A=v;if(!A){for(var N=p.parent;N&&N.f&Me;)for(;(N=N.parent)&&!(N.f&Qe););A=!N||(N.f&Pe)!==0}A&&Je(()=>{qe(()=>E.in())})}}function W(a,e,r,f,s){var u=f===1;if(Ke(e)){var l,v=!1;return _e(()=>{if(!v){var p=e({direction:u?"in":"out"});l=W(a,p,r,f,s)}}),{abort:()=>{v=!0,l==null||l.abort()},deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:()=>l.t()}}if(r==null||r.deactivate(),!(e!=null&&e.duration))return s(),{abort:F,deactivate:F,reset:F,t:()=>f};const{delay:T=0,css:h,tick:c,easing:y=ia}=e;var n=[];if(u&&r===void 0&&(c&&c(0,1),h)){var t=fe(h(0,1));n.push(t,t)}var i=()=>1-f,E=a.animate(n,{duration:T});return E.onfinish=()=>{var p=(r==null?void 0:r.t())??1-f;r==null||r.abort();var A=f-p,N=e.duration*Math.abs(A),_=[];if(N>0){var o=!1;if(h)for(var d=Math.ceil(N/16.666666666666668),x=0;x<=d;x+=1){var D=p+A*y(x/d),m=fe(h(D,1-D));_.push(m),o||(o=m.overflow==="hidden")}o&&(a.style.overflow="hidden"),i=()=>{var g=E.currentTime;return p+A*y(g/N)},c&&ta(()=>{if(E.playState!=="running")return!1;var g=i();return c(g,1-g),!0})}E=a.animate(_,{duration:N,fill:"forwards"}),E.onfinish=()=>{i=()=>f,c==null||c(f,1-f),s()}},{abort:()=>{E&&(E.cancel(),E.effect=null,E.onfinish=F)},deactivate:()=>{s=F},reset:()=>{f===0&&(c==null||c(1,0))},t:()=>i()}}const K=M({current:{}}),fa=M({current:[]}),w=1,C=3;let k=he(null);function Na({watchlist:a,symbol:e}){let r=he(null);$e().subscribe(u=>{ne(r,M(u))});const s=Ye(()=>u=>{var v;const l={[w]:[],[C]:[]};a?(v=a["watchlist-entries"])==null||v.forEach(({symbol:T})=>{l[w].push({symbol:T,type:"Quote"}),l[C].push({symbol:T,type:"Candle"})}):e&&l[C].push({symbol:`${e}{=30m}`,type:"Candle",fromTime:Date.now()-1e3*60*60*24}),l[w].length&&(!u||u===w)&&S(k).send(JSON.stringify({type:"FEED_SUBSCRIPTION",channel:w,add:l[w]})),l[C].length&&(!u||u===C)&&S(k).send(JSON.stringify({type:"FEED_SUBSCRIPTION",channel:C,add:l[C]}))});Ve(()=>{var u;(u=S(r))!=null&&u.isSuccess&&(S(k)||ne(k,M(new WebSocket(S(r).data.data["dxlink-url"]))),(a||e)&&WebSocket.OPEN===S(k).readyState&&S(s)(),S(k).onopen=()=>{S(k).send(JSON.stringify({type:"SETUP",channel:0,keepaliveTimeout:60,acceptKeepaliveTimeout:60,version:"1.0.0"}))},S(k).onmessage=l=>{var T,h;const v=JSON.parse(l.data);switch(console.log(v),v.type){case"SETUP":S(k).send(JSON.stringify({type:"AUTH",channel:0,token:(h=(T=S(r))==null?void 0:T.data)==null?void 0:h.data.token}));break;case"AUTH_STATE":v.state==="AUTHORIZED"&&(S(k).send(JSON.stringify({type:"CHANNEL_REQUEST",channel:w,service:"FEED",parameters:{contract:"AUTO"}})),S(k).send(JSON.stringify({type:"CHANNEL_REQUEST",channel:C,service:"FEED",parameters:{contract:"AUTO"}})));break;case"CHANNEL_OPENED":S(s)(v.channel);break;case"FEED_DATA":{const c={},y=[];let n=!1;je(v.data[1],v.channel===w?"Quote":"Candle").filter(Array.isArray).forEach(t=>{if(a){const[i]=t,E=v.channel===w?{name:i,bid:t[6],ask:t[10]}:{name:i,last:t[10]};c[i]={...K.current[i],...E}}else e&&t[0].includes("{")&&(n=!0,t[7]&&t[10]&&y.push({name:e,time:new Date(t[4]).toISOString(),open:t[7],high:t[8],low:t[9],close:t[10]}))}),a?K.current={...K.current,...c}:n&&(fa.current=[...y]);break}}})})}export{K as a,ha as b,fa as c,da as e,_a as i,va as k,ta as l,I as r,Ea as s,pa as t,Na as u};
