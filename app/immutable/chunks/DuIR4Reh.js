import{h as S,d as ue,az as me,aA as be,aB as Se,b as ce,g as oe,e as V,i as U,U as ye,A as m,_ as ke,H as we,j,k as Q,l as J,aq as Ie,m as ve,au as _e,P as Ce,V as Oe,I as ee,aC as q,M as L,aD as W,aE as ae,aF as De,at as ge,aG as Ue,aH as Fe,aI as z,aJ as Re,an as xe,aa as He,a9 as Le,aK as de,q as he,aL as Pe,E as Me,aM as Qe,aN as Je,n as qe,u as Be,aO as Ke,a8 as Ve,T as x,ai as re,aj as te,ak as We,aP as ze,aQ as Ge,K as se,ag as Ee,x as Ye,C as Ze}from"./Co3I69cU.js";import{b as Xe,w as $e}from"./Dnu7mS3Z.js";import{a as ne}from"./DeV2abX_.js";import{b as je,d as ea,e as B,f as ie}from"./41he7gHu.js";function va(a,e,r){S&&ue();var i=a,t=ye,l,n=me()?be:Se;ce(()=>{n(t,t=e())&&(l&&oe(l),l=V(()=>r(i)))}),S&&(i=U)}function _a(a,e){return e}function aa(a,e,r,i){for(var t=[],l=e.length,n=0;n<l;n++)De(e[n].e,t,!0);var N=l>0&&t.length===0&&r!==null;if(N){var p=r.parentNode;ge(p),p.append(r),i.clear(),O(a,e[0].prev,e[l-1].next)}Ue(t,()=>{for(var A=0;A<l;A++){var o=e[A];N||(i.delete(o.k),O(a,o.prev,o.next)),Fe(o.e,!N)}})}function da(a,e,r,i,t,l=null){var n=a,N={flags:e,items:new Map,first:null},p=(e&de)!==0;if(p){var A=a;n=S?Q(He(A)):A.appendChild(Le())}S&&ue();var o=null,b=!1,s=ke(()=>{var u=r();return Ce(u)?u:u==null?[]:_e(u)});ce(()=>{var u=m(s),f=u.length;if(b&&f===0)return;b=f===0;let T=!1;if(S){var c=n.data===we;c!==(f===0)&&(n=j(),Q(n),J(!1),T=!0)}if(S){for(var d=null,_,h=0;h<f;h++){if(U.nodeType===8&&U.data===Ie){n=U,T=!0,J(!1);break}var v=u[h],E=i(v,h);_=pe(U,N,d,null,v,E,h,t,e,r),N.items.set(E,_),d=_}f>0&&Q(j())}S||ra(u,N,n,t,e,i,r),l!==null&&(f===0?o?ve(o):o=V(()=>l(n)):o!==null&&oe(o,()=>{o=null})),T&&J(!0),m(s)}),S&&(n=U)}function ra(a,e,r,i,t,l,n){var G,Y,Z,X;var N=(t&Pe)!==0,p=(t&(z|W))!==0,A=a.length,o=e.items,b=e.first,s=b,u,f=null,T,c=[],d=[],_,h,v,E;if(N)for(E=0;E<A;E+=1)_=a[E],h=l(_,E),v=o.get(h),v!==void 0&&((G=v.a)==null||G.measure(),(T??(T=new Set)).add(v));for(E=0;E<A;E+=1){if(_=a[E],h=l(_,E),v=o.get(h),v===void 0){var F=s?s.e.nodes_start:r;f=pe(F,e,f,f===null?e.first:f.next,_,h,E,i,t,n),o.set(h,f),c=[],d=[],s=f.next;continue}if(p&&ta(v,_,E,t),v.e.f&q&&(ve(v.e),N&&((Y=v.a)==null||Y.unfix(),(T??(T=new Set)).delete(v))),v!==s){if(u!==void 0&&u.has(v)){if(c.length<d.length){var D=d[0],k;f=D.prev;var g=c[0],P=c[c.length-1];for(k=0;k<c.length;k+=1)fe(c[k],D,r);for(k=0;k<d.length;k+=1)u.delete(d[k]);O(e,g.prev,P.next),O(e,f,g),O(e,P,D),s=D,f=P,E-=1,c=[],d=[]}else u.delete(v),fe(v,s,r),O(e,v.prev,v.next),O(e,v,f===null?e.first:f.next),O(e,f,v),f=v;continue}for(c=[],d=[];s!==null&&s.k!==h;)s.e.f&q||(u??(u=new Set)).add(s),d.push(s),s=s.next;if(s===null)continue;v=s}c.push(v),f=v,s=v.next}if(s!==null||u!==void 0){for(var R=u===void 0?[]:_e(u);s!==null;)s.e.f&q||R.push(s),s=s.next;var M=R.length;if(M>0){var Te=t&de&&A===0?r:null;if(N){for(E=0;E<M;E+=1)(Z=R[E].a)==null||Z.measure();for(E=0;E<M;E+=1)(X=R[E].a)==null||X.fix()}aa(e,R,Te,o)}}N&&he(()=>{var $;if(T!==void 0)for(v of T)($=v.a)==null||$.apply()}),L.first=e.first&&e.first.e,L.last=f&&f.e}function ta(a,e,r,i){i&z&&ae(a.v,e),i&W?ae(a.i,r):a.i=r}function pe(a,e,r,i,t,l,n,N,p,A){var o=(p&z)!==0,b=(p&Re)===0,s=o?b?Oe(t):ee(t):t,u=p&W?ee(n):n,f={i:u,v:s,k:l,a:null,e:null,prev:r,next:i};try{return f.e=V(()=>N(a,s,u,A),S),f.e.prev=r&&r.e,f.e.next=i&&i.e,r===null?e.first=f:(r.next=f,r.e.next=f.e),i!==null&&(i.prev=f,i.e.prev=f.e),f}finally{}}function fe(a,e,r){for(var i=a.next?a.next.e.nodes_start:r,t=e?e.e.nodes_start:r,l=a.e.nodes_start;l!==i;){var n=xe(l);t.before(l),l=n}}function O(a,e,r){e===null?a.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}function ha(a,e,r){var i=a.__className,t=Ne(e);S&&a.getAttribute("class")===t?a.__className=t:(i!==t||S&&a.getAttribute("class")!==t)&&(t===""?a.removeAttribute("class"):a.setAttribute("class",t),a.__className=t)}function Ea(a,e,r){var i=a.__className,t=Ne(e);S&&a.className===t?a.__className=t:(i!==t||S&&a.className!==t)&&(e==null?a.removeAttribute("class"):a.className=t,a.__className=t)}function Ne(a,e){return(a??"")+""}const sa=()=>performance.now(),C={tick:a=>requestAnimationFrame(a),now:()=>sa(),tasks:new Set};function Ae(){const a=C.now();C.tasks.forEach(e=>{e.c(a)||(C.tasks.delete(e),e.f())}),C.tasks.size!==0&&C.tick(Ae)}function na(a){let e;return C.tasks.size===0&&C.tick(Ae),{promise:new Promise(r=>{C.tasks.add(e={c:a,f:r})}),abort(){C.tasks.delete(e)}}}function H(a,e){$e(()=>{a.dispatchEvent(new CustomEvent(e))})}function ia(a){if(a==="float")return"cssFloat";if(a==="offset")return"cssOffset";if(a.startsWith("--"))return a;const e=a.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function le(a){const e={},r=a.split(";");for(const i of r){const[t,l]=i.split(":");if(!t||l===void 0)break;const n=ia(t.trim());e[n]=l.trim()}return e}const fa=a=>a;function pa(a,e,r,i){var t=(a&ze)!==0,l=(a&Ge)!==0,n=t&&l,N=(a&Ke)!==0,p=n?"both":t?"in":"out",A,o=e.inert,b=e.style.overflow,s,u;function f(){var h=We,v=L;re(null),te(null);try{return A??(A=r()(e,(i==null?void 0:i())??{},{direction:p}))}finally{re(h),te(v)}}var T={is_global:N,in(){var h;if(e.inert=o,!t){u==null||u.abort(),(h=u==null?void 0:u.reset)==null||h.call(u);return}l||s==null||s.abort(),H(e,"introstart"),s=K(e,f(),u,1,()=>{H(e,"introend"),s==null||s.abort(),s=A=void 0,e.style.overflow=b})},out(h){if(!l){h==null||h(),A=void 0;return}e.inert=!0,H(e,"outrostart"),u=K(e,f(),s,0,()=>{H(e,"outroend"),h==null||h()})},stop:()=>{s==null||s.abort(),u==null||u.abort()}},c=L;if((c.transitions??(c.transitions=[])).push(T),t&&Xe){var d=N;if(!d){for(var _=c.parent;_&&_.f&Me;)for(;(_=_.parent)&&!(_.f&Qe););d=!_||(_.f&Je)!==0}d&&qe(()=>{Be(()=>T.in())})}}function K(a,e,r,i,t){var l=i===1;if(Ve(e)){var n,N=!1;return he(()=>{if(!N){var c=e({direction:l?"in":"out"});n=K(a,c,r,i,t)}}),{abort:()=>{N=!0,n==null||n.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(r==null||r.deactivate(),!(e!=null&&e.duration))return t(),{abort:x,deactivate:x,reset:x,t:()=>i};const{delay:p=0,css:A,tick:o,easing:b=fa}=e;var s=[];if(l&&r===void 0&&(o&&o(0,1),A)){var u=le(A(0,1));s.push(u,u)}var f=()=>1-i,T=a.animate(s,{duration:p});return T.onfinish=()=>{var c=(r==null?void 0:r.t())??1-i;r==null||r.abort();var d=i-c,_=e.duration*Math.abs(d),h=[];if(_>0){var v=!1;if(A)for(var E=Math.ceil(_/16.666666666666668),F=0;F<=E;F+=1){var D=c+d*b(F/E),k=le(A(D,1-D));h.push(k),v||(v=k.overflow==="hidden")}v&&(a.style.overflow="hidden"),f=()=>{var g=T.currentTime;return c+d*b(g/_)},o&&na(()=>{if(T.playState!=="running")return!1;var g=f();return o(g,1-g),!0})}T=a.animate(h,{duration:_,fill:"forwards"}),T.onfinish=()=>{f=()=>i,o==null||o(i,1-i),t()}},{abort:()=>{T&&(T.cancel(),T.effect=null,T.onfinish=x)},deactivate:()=>{t=x},reset:()=>{i===0&&(o==null||o(1,0))},t:()=>f()}}const w=1,I=3;let y=Ee(null);function Na({watchlist:a,symbol:e}){let r=Ee(null);je().subscribe(l=>{se(r,ne(l))});const t=Ze(()=>l=>{var N;const n={[w]:[],[I]:[]};a?(N=a["watchlist-entries"])==null||N.forEach(({symbol:p})=>{n[w].push({symbol:p,type:"Quote"}),n[I].push({symbol:p,type:"Candle"})}):e&&(n[I].push({symbol:`${e}{=30m}`,type:"Candle",fromTime:Date.now()-1e3*60*60*24}),n[I].push({symbol:e,type:"Candle"})),n[w].length&&(!l||l===w)&&m(y).send(JSON.stringify({type:"FEED_SUBSCRIPTION",channel:w,add:n[w]})),n[I].length&&(!l||l===I)&&m(y).send(JSON.stringify({type:"FEED_SUBSCRIPTION",channel:I,add:n[I]}))});Ye(()=>{var l,n;(l=m(r))!=null&&l.isSuccess&&(m(y)||se(y,ne(new WebSocket((n=m(r).data.data)==null?void 0:n["dxlink-url"]))),(a||e)&&WebSocket.OPEN===m(y).readyState&&m(t)(),m(y).onopen=()=>{m(y).send(JSON.stringify({type:"SETUP",channel:0,keepaliveTimeout:60,acceptKeepaliveTimeout:60,version:"1.0.0"}))},m(y).onmessage=N=>{var A,o,b;const p=JSON.parse(N.data);switch(console.log(p),p.type){case"SETUP":m(y).send(JSON.stringify({type:"AUTH",channel:0,token:(o=(A=m(r))==null?void 0:A.data)==null?void 0:o.data.token}));break;case"AUTH_STATE":p.state==="AUTHORIZED"&&(m(y).send(JSON.stringify({type:"CHANNEL_REQUEST",channel:w,service:"FEED",parameters:{contract:"AUTO"}})),m(y).send(JSON.stringify({type:"CHANNEL_REQUEST",channel:I,service:"FEED",parameters:{contract:"AUTO"}})));break;case"CHANNEL_OPENED":m(t)(p.channel);break;case"KEEPALIVE":(b=m(y))==null||b.send(JSON.stringify({channel:p.channel,type:"KEEPALIVE"}));break;case"FEED_DATA":{const s={},u=[];let f=!1,T=!1;if(ea(p.data[1],p.channel===w?"Quote":"Candle").filter(Array.isArray).forEach(c=>{if(e&&c[0].includes("{")){T=!0;const d=Number(c[7]),_=Number(c[10]);d&&_&&u.push({name:e,time:new Date(c[4]).toISOString(),open:d,high:Number(c[8]),low:Number(c[9]),close:_})}else{f=!0;const[d]=c,_=p.channel===w?{name:d,bid:Number(c[6]),ask:Number(c[10])}:{name:d,last:Number(c[10])};s[d]={...B.current[d],..._}}}),f)B.current={...B.current,...s};else if(T){const c=[...ie[e]||[],...u];c.sort((d,_)=>d.time.localeCompare(_.time)),ie[e]=c}break}}})})}export{ha as a,da as e,_a as i,va as k,na as l,C as r,Ea as s,pa as t,Na as u};
